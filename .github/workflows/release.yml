# CLDMV/.github/.github/workflows/release.yml
name: Release Workflow (Org-Level)

on:
  workflow_call:
    inputs:
      package_name:
        required: true
        type: string
        description: "NPM package name (e.g., @cldmv/slothlet)"
      node_version:
        required: false
        type: string
        default: "lts/*"
        description: "Node.js version to use"
      package_manager:
        required: false
        type: string
        default: "npm"
        description: "Package manager (npm or yarn)"
      build_command:
        required: false
        type: string
        default: "npm run build:ci"
        description: "Command to build package"
      version_bump:
        required: false
        type: string
        default: "patch"
        description: "Type of version bump (major, minor, patch)"
    outputs:
      release-pr-created:
        description: "Whether a release PR was created"
        value: ${{ jobs.release.outputs.pr-created }}
      release-pr-number:
        description: "The release PR number if created"
        value: ${{ jobs.release.outputs.pr-number }}
      new-version:
        description: "The new version that was set"
        value: ${{ jobs.release.outputs.new-version }}

    secrets:
      NPM_TOKEN:
        description: "NPM token for publishing packages"
        required: false

jobs:
  release:
    name: "ðŸš€ Release Management"
    uses: ./.github/workflows/ci-jobs.yml
    with:
      package_name: ${{ inputs.package_name }}
      run_detect_release: true
      run_create_release_pr: true
      node_version: ${{ inputs.node_version }}
      package_manager: ${{ inputs.package_manager }}
      build_command: ${{ inputs.build_command }}
      version_bump: ${{ inputs.version_bump }}
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
