name: üè∑Ô∏è Update Version Tags (Caller)

on:
  release:
    types: [published]
  push:
  workflow_dispatch:
    inputs:
      debug:
        description: "Enable debug logging for troubleshooting"
        type: boolean
        required: false
        default: false
      use_gpg:
        description: "Use GPG signing via CLDMV_ secrets?"
        type: boolean
        required: true
        default: true
      create_documentation:
        description: "Create/update VERSION_TAGS.md"
        required: false
        default: "true"

permissions:
  contents: write

jobs:
  update-tags:
    uses: ./.github/workflows/update-major-version-tags.yml
    permissions:
      contents: write
    with:
      debug: ${{ (github.event_name == 'workflow_dispatch' && (github.event.inputs.debug == 'true' || github.event.inputs.debug == true)) || false }}
      create_documentation: ${{ (github.event_name == 'workflow_dispatch' && (github.event.inputs.create_documentation == 'true' || github.event.inputs.create_documentation == true)) || (github.event_name != 'workflow_dispatch' && true) }}
      # let the reusable decide whether to use secrets based on this flag
      use_gpg: ${{ (github.event_name == 'workflow_dispatch' && (github.event.inputs.use_gpg == 'true' || github.event.inputs.use_gpg == true)) || (github.event_name != 'workflow_dispatch' && true) }}
      # Note: use_app_token is automatically determined in the reusable workflow based on BOT_APP_ID presence
    secrets:
      # map your repo/org secrets into generic names expected by the reusable
      TAGGER_NAME: ${{ secrets.CLDMV_BOT_NAME }}
      TAGGER_EMAIL: ${{ secrets.CLDMV_BOT_EMAIL }}
      GPG_PRIVATE_KEY: ${{ secrets.CLDMV_BOT_GPG_PRIVATE_KEY }}
      GPG_PASSPHRASE: ${{ secrets.CLDMV_BOT_GPG_PASSPHRASE }}
      BOT_APP_ID: ${{ secrets.CLDMV_BOT_APP_ID }}
      BOT_APP_PRIVATE_KEY: ${{ secrets.CLDMV_BOT_APP_PRIVATE_KEY }}
