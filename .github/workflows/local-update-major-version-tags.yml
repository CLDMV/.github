name: üè∑Ô∏è Update Version Tags (Caller)

on:
  release:
    types: [published]
  push:
  workflow_dispatch:
    inputs:
      use_gpg:
        description: "Use GPG signing via CLDMV_ secrets?"
        type: boolean
        required: true
        default: true
      sign:
        description: "sign mode: auto | true | false"
        required: false
        default: "auto"
      annotate:
        description: "annotate mode: auto | true | false"
        required: false
        default: "auto"
      create_documentation:
        description: "Create/update VERSION_TAGS.md"
        required: false
        default: "true"

permissions:
  contents: write

jobs:
  update-tags:
    uses: ./.github/workflows/update-major-version-tags.yml
    permissions:
      contents: write
    with:
      create_documentation: "${{ github.event.inputs.create_documentation || 'true' }}"
      sign: "${{ github.event.inputs.sign || 'auto' }}"
      annotate: "${{ github.event.inputs.annotate || 'auto' }}"
      # let the reusable decide whether to use secrets based on this flag
      use_gpg: "${{ github.event_name == 'workflow_dispatch' && ((github.event.inputs.use_gpg == 'true' || github.event.inputs.use_gpg == true) && 'true' || 'false') || 'true' }}"
      # Note: use_app_token is automatically determined in the reusable workflow based on BOT_APP_ID presence
    secrets:
      # map your repo/org secrets into generic names expected by the reusable
      TAGGER_NAME: ${{ secrets.CLDMV_BOT_NAME }}
      TAGGER_EMAIL: ${{ secrets.CLDMV_BOT_EMAIL }}
      GPG_PRIVATE_KEY: ${{ secrets.CLDMV_BOT_GPG_PRIVATE_KEY }}
      GPG_PASSPHRASE: ${{ secrets.CLDMV_BOT_GPG_PASSPHRASE }}
      BOT_APP_ID: ${{ secrets.CLDMV_BOT_APP_ID }}
      BOT_APP_PRIVATE_KEY: ${{ secrets.CLDMV_BOT_APP_PRIVATE_KEY }}
