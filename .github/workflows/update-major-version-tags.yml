# .github/workflows/update-major-version-tags.yml
name: ðŸ“Œ Update Major Version Tags

on:
  workflow_call:
    inputs:
      create_documentation:
        description: "Whether to create/update VERSION_TAGS.md documentation"
        required: false
        type: boolean
        default: true
      sign:
        description: "Smart signing mode (auto/true/false)"
        required: false
        type: string
        default: "auto"
      annotate:
        description: "Smart annotate mode (auto/true/false)"
        required: false
        type: string
        default: "auto"
      use_gpg:
        description: "If true, forward provided secrets to enable signing"
        required: false
        type: boolean
        default: false
    secrets:
      TAGGER_NAME:
        required: false
      TAGGER_EMAIL:
        required: false
      GPG_PRIVATE_KEY:
        required: false
      GPG_PASSPHRASE:
        required: false

permissions:
  contents: write

jobs:
  update:
    name: Update major/minor version tags
    runs-on: ubuntu-latest
    outputs:
      major-version: ${{ steps.tags.outputs.major-version }}
      minor-version: ${{ steps.tags.outputs.minor-version }}
      updated: ${{ steps.tags.outputs.updated }}
      has-version-tags: ${{ steps.tags.outputs.has-version-tags }}
      should-run: ${{ steps.tags.outputs.should-run }}
    steps:
      - name: Check for version tags and update
        id: tags
        uses: CLDMV/.github/.github/actions/git/jobs/update-major-version-tags@v1
        with:
          create-documentation: ${{ inputs.create_documentation }}
          sign: ${{ inputs.sign }}
          annotate: ${{ inputs.annotate }}

          # forward identity & GPG only if toggled on
          tagger_name: ${{ inputs.use_gpg && secrets.TAGGER_NAME   || '' }}
          tagger_email: ${{ inputs.use_gpg && secrets.TAGGER_EMAIL  || '' }}
          gpg_private_key: ${{ inputs.use_gpg && secrets.GPG_PRIVATE_KEY || '' }}
          gpg_passphrase: ${{ inputs.use_gpg && secrets.GPG_PASSPHRASE  || '' }}
