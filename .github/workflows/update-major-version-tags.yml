# CLDMV/.github/.githujobs:
name: ðŸ“Œ Update Major Version Tags

on:
  workflow_call:
    inputs:
      create_documentation:
        description: "Whether to create/update VERSION_TAGS.md documentation"
        required: false
        type: boolean
        default: true
      sign:
        description: "Smart signing mode (auto/true/false)"
        required: false
        type: string
        default: "auto"
      annotate:
        description: "Smart annotate mode (auto/true/false)"
        required: false
        type: string
        default: "auto"
      tagger_name:
        description: "Tagger name"
        required: false
        type: string
      tagger_email:
        description: "Tagger email"
        required: false
        type: string
      gpg_private_key:
        description: "ASCII-armored private key for signing"
        required: false
        type: string
      gpg_passphrase:
        description: "Passphrase for the private key (if protected)"
        required: false
        type: string
        description: "Whether to create/update VERSION_TAGS.md documentation"
        required: false
        type: boolean
        default: true
    outputs:
      major-version:
        description: "The major version tag that was updated"
        value: ${{ jobs.update-tags.outputs.major-version }}
      minor-version:
        description: "The minor version tag that was updated"
        value: ${{ jobs.update-tags.outputs.minor-version }}
      updated:
        description: "Whether tags were successfully updated"
        value: ${{ jobs.update-tags.outputs.updated }}

permissions:
  contents: write

jobs:
  update-tags:
    name: "ðŸš€ Execute Tag Updates"
    # Run on: tag pushes or releases only (workflow_call bypasses this condition)
    if: github.ref_type == 'tag' || github.event_name == 'release'
    permissions:
      contents: write
    runs-on: ubuntu-latest
    outputs:
      major-version: ${{ steps.tags.outputs.major-version }}
      minor-version: ${{ steps.tags.outputs.minor-version }}
      updated: ${{ steps.tags.outputs.updated }}
      has-version-tags: ${{ steps.tags.outputs.has-version-tags }}
      should-run: ${{ steps.tags.outputs.should-run }}
    steps:
      - name: Check for version tags and update
        id: tags
        uses: CLDMV/.github/.github/actions/git/jobs/update-major-version-tags@v1
        with:
          create-documentation: ${{ inputs.create_documentation || 'true' }}
          sign: ${{ inputs.sign }}
          annotate: ${{ inputs.annotate }}
          tagger_name: ${{ inputs.tagger_name || secrets.CLDMV_BOT_NAME }}
          tagger_email: ${{ inputs.tagger_email || secrets.CLDMV_BOT_EMAIL }}
          gpg_private_key: ${{ inputs.gpg_private_key }}
          gpg_passphrase: ${{ inputs.gpg_passphrase }}
          CLDMV_BOT_GPG_PASSPHRASE: ${{ secrets.CLDMV_BOT_GPG_PASSPHRASE }}
          CLDMV_BOT_NAME: ${{ secrets.CLDMV_BOT_NAME }}
          CLDMV_BOT_EMAIL: ${{ secrets.CLDMV_BOT_EMAIL }}

